require "keccak1600_orig_avx2.jinc"

param int BUFLEN = 1741;
param int OUTLEN = 2329;

/*
export fn test_oldabsorb
( reg mut ptr u256[7] sta
, reg u64 buf
) -> reg ptr u256[7]
{
  reg u256[7] st;
  reg u64 r8, inlen;
  reg u8 trail;
  inline int i;
  st = __state_init_avx2();
  inlen = BUFLEN;
  r8 = 136;
  trail = 0x06;
  st = __absorb_avx2(st, buf, inlen, trail, r8);
  for i = 0 to 7 { sta[i] = st[i]; }
  return sta;
}
*/

export fn test_oldshake
( reg mut ptr u256[7] stm
, reg u64 outbuf inbuf
) -> reg ptr u256[7]
{
  reg u256[7] st;
  reg u64 r8, inlen, outlen;
  reg u8 trail;
  inline int i;
  st = __state_init_avx2();
  inlen = BUFLEN;
  outlen = OUTLEN;
  r8 = R136;
  trail = SHAKE;
  // absorb
  st = __absorb_avx2(st, inbuf, inlen, trail, r8);
  // squeeze
  st = __squeeze_avx2(st, outbuf, outlen, r8);
  for i = 0 to 7 { stm[i] = st[i]; }
  return stm;
}

/*
export fn test_keccakF
( reg mut ptr u256[7] sta
) -> reg ptr u256[7]
{
  reg u256[7] st;
  inline int i;
  st = __state_init_avx2();
  st = _keccakf1600_avx2(st);
  for i = 0 to 7 { sta[i] = st[i]; }
  return sta;
}
*/
